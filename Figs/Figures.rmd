---
title: "Glider sampling simulation figures"
author:
  - Doug Kinzey, AERD
date: "08/23/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load the database of acoustic backscatter coefficients (s[a])
'NASC_leg1.RData' (dimensions 100 x 199772) contains the krill acoustic backscatter values (s[a]) binned into 100 m horizontal by 5 m vertical cells  (transposed in the simulation functions for easier visualization).

```{r load_data}
load('NASC_leg1.RData')
```

# Figure 2: Sample paths of 3 yos to maximum depth of 150 m, and 1000 m
```{r f2, ,fig.width=7,fig.height=7, fig.show="hold", out.width="50%"}
source('Fig2.r')
Fig2()

Fig2(yo.depths.m=rep(1000,3),max.z.m=1005)
```

Figure 2. Schematic sample path of a glider completing 3 dives at with a maximum depth of (a) 150 m and (b) 1000 m. In each case the echosounder is shut off at 150 m, but the water column is ensonified to 250 m. Black cells indicate when the echosounder is recording and light gray represents the 100 m sampled below the glider. We computed a mean backscatter across the cells within each depth bin sampled during a dive and then summed vertically to produce glider samples of depth-integrated backscatter.

# Figure 3: Plot the summed s[a] at each 5m depth in the database

'Fig3.r' calculates a plot of the summed s[a] values at each depth, illustrating the overall relationship of krill density with depth.
```{r fig3, fig.width=3.5,fig.height=4}
source('Fig3.r')
```

Figure 3. Mean acoustic backscatter coefficients (sa) in 5 m depth bins of the population being sampled by simulated gliders for both strata and all years combined.

# Figure 4: Plot the CV of s[a]  and the proportion of zero density bins at each 5m depth in the database
```{r fig4, fig.width=7,fig.height=7, fig.show="hold", out.width="50%"}
source('Fig4.r')
```

Figure 4. CVs of acoustic backscatter (left) and proportions of bins with zero acoustic energy (right) at depth in the combined database sampled by the simulated gliders.

# Figure 5

Figure 5 shows the fit of the glider samples ('gldr.smpls.yrs') of acoustic density (s[a]) to the operating model values ('ship.sums') for each strata and year. 'plot_Sa_fits.r' plots the fits of the glider samples (grey) to the operating model (red). Figure 5 requires 'Glider_simulation.rmd' to have been already rendered to provide the data. The example shows 9 replicates. More replicates can be sampled using the 'n.reps' argument to 'Fig5.r'.

```{r Fig5, fig.width=7,fig.height=7,}
source('Fig5.r')
source('plot_Sa_fits.r')
```
